{
  "hash": "5c7a4c1c976eb861e8f1b545b7651aa7",
  "result": {
    "engine": "knitr",
    "markdown": "::: {.cell}\n\n:::\n\n\n\n\n# tmap\n\n[tmap](https://r-tmap.github.io/tmap/) is a popular package for making maps. It uses the concepts of a Grammar of Graphics to layer data as well as visuzalization rules. If you're familiar with the `ggplot2` package, this will feel similar. If you're not familiar with `ggplot2` (or not a fan), that's ok because `tmap` uses layers in much the same way we just built maps using the base R `plot()` function.\n\n## Simple Map\n\nFirst, we load the libraries we'll need:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\t#install.packages(\"tmap\")\n  library(\"tmap\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'tmap' was built under R version 4.4.3\n```\n\n\n:::\n:::\n\n\n\n\nGrammar of Graphics tools typically follow a pattern: first you indicate which data you want to work with, then you indicate the way the data should be styled. Let's map the states data to see a basic no-frills example:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\ttm_shape(states) +  #the data we want to map\n    tm_polygons()     #style the data using the defaults\n```\n\n::: {.cell-output-display}\n![](tmap_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n\n\n## Multiple Layers\n\nWith `tmap`, if we want to add multiple layers to the map, we can think of each layer as a separate map that we stack together. For our map, we'll first make the layer that contains the states, then we'll add a layer that contains the lakes, then a final layer that contains the monsters.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\tmap_states <- tm_shape(states) +  \n    tm_polygons() \n\n  map_lakes <- map_states +         #start with the states map\n    tm_shape(lakes) +               #add the lakes data\n    tm_polygons()                   #style the lakes data\n  \n  map_monsters <- map_lakes +       #start with the lakes map\n    tm_shape(monsters) +            #add the monsters data\n    tm_dots()                       #style the monsters data\n  \n  map_monsters                      #call the map variable to plot the map inside it\n```\n\n::: {.cell-output-display}\n![](tmap_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\n## Styling\n\nThe goal of styling our data is to help it communicate better. Dots on top of state outlines are definitely difficult to understand. Let's change the plotting arguments to make something more readable and to fit the story we want to tell.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n  #create a bounding box object for the zoom area of our map\n  aoi <- st_bbox(c(xmin = -96, xmax = -73, ymax = 50, ymin = 40), crs = st_crs(4326))\n\n\n\tmap_states <- \n\t  tm_shape(states, \n\t     bbox = aoi) +                    #set the extend for the map\n\t  \n    tm_polygons(\n      fill=\"white\",                     #fill the polygons with white\n      col=\"gray30\") +                   #make the outline dark gray\n    tm_layout(bg.color=\"lightblue3\")    #set the background color with the layout options\n\n  \n\tmap_lakes <- map_states +         \n    tm_shape(lakes) +               \n    tm_polygons(\n      fill = \"lightblue\",               #fill the polygons with light blue\n      col=\"lightblue4\"                  #make the outline a darker blue\n      )                   \n  \n  map_monsters <- map_lakes +       \n    tm_shape(monsters) +            \n    tm_dots(size=.5)                    #set the size of the points              \n  \n  map_monsters                      \n```\n\n::: {.cell-output-display}\n![](tmap_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n\n\n## Add Text Labels\n\nLet's add some text labels so we know what the names of each of the monsters are. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n  #create a bounding box object for the zoom area of our map\n  aoi <- st_bbox(c(xmin = -96, xmax = -73, ymax = 50, ymin = 40), crs = st_crs(4326))\n\n\n\tmap_states <- \n\t  tm_shape(states, \n\t     bbox = aoi) +                    \n\t  \n    tm_polygons(\n      fill=\"white\",                     \n      col=\"gray30\") +                   \n    tm_layout(bg.color=\"lightblue3\")    \n\n  \n\tmap_lakes <- map_states +         \n    tm_shape(lakes) +               \n    tm_polygons(\n      fill = \"lightblue\",               \n      col=\"lightblue4\"                  \n      )                   \n  \n  map_monsters <- map_lakes +       \n    tm_shape(monsters) +            \n    tm_dots(size=.5) +\n    \n    tm_text(\"Name\")             #create labels, specifying the column to use\n  \n  map_monsters                      \n```\n\n::: {.cell-output-display}\n![](tmap_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n\nLabeling of points is challenging for `tmap`. It doesn't have a way to avoid label collisions (overlaps) and the placement options don't really do much to avoid labels running over the symbols.  I also haven't found much guidance on placing the labels.  Most of the tutorials avoid this problem by labeling polygons where the exact placement isn't a concern.  Like the discussion of `plot()`, this map would benefit from moving the labels by hand. Export a pdf and edit it in a vector illustration software like Inkscape or Adobe Illustrator.\n\n\n## North Arrow & Scale Bar\n\nOne big benefit of the `tmap` workflow is the built in option to add norh arrows and scale bars.  Adding them in is super simple and if you're happy with the defaults, it's pretty quick.  We'll put ours in the lower left corner where they won't cover up our monster points. Also, we're adding these to the last layer of the map we built so that the arrow and scale bar don't get covered up by anything else. (Note I'm taking out the labels because they are messy.)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n  #create a bounding box object for the zoom area of our map\n  aoi <- st_bbox(c(xmin = -96, xmax = -73, ymax = 50, ymin = 40), crs = st_crs(4326))\n\n\n\tmap_states <- \n\t  tm_shape(states, \n\t     bbox = aoi) +                    \n\t  \n    tm_polygons(\n      fill=\"white\",                     \n      col=\"gray30\") +                   \n    tm_layout(bg.color=\"lightblue3\")    \n\n  \n\tmap_lakes <- map_states +         \n    tm_shape(lakes) +               \n    tm_polygons(\n      fill = \"lightblue\",               \n      col=\"lightblue4\"                  \n      )                   \n  \n  map_monsters <- map_lakes +       \n    tm_shape(monsters) +            \n    tm_dots(size=.5) +\n    \n    tm_compass(position=c(\"left\", \"bottom\")) +     #add the north arrow (compass rose)\n    tm_scalebar(position=c(\"left\", \"bottom\"))      #add the scale bar\n    \n  \n  map_monsters                      \n```\n\n::: {.cell-output-display}\n![](tmap_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n# Ready-Made Tile Services\n\nAnother benefit of the `tmap` workflow is the easy availability of using tile services (commonly known as \"basemaps\" but people use that term to mean so many other things as well). Tile services are continuous map layers that are stored in square chunks (tiles) so you only need to load the part of the world in your area of interest. One tile service that may people are familiar with is Google Maps, but open data like OpenStreetMap is also available as a tile service.\n\nRemember that even if a tile service makes a dataset easy to use, you still need to comply with the terms of service for that specific dataset.\n\nLet's replace our base layers (states and lakes) with the default basemap.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n  #create a bounding box object for the zoom area of our map\n  aoi <- st_bbox(c(xmin = -96, xmax = -73, ymax = 50, ymin = 40), crs = st_crs(4326))\n\n\n\t  map_monsters <-  \n\t    tm_basemap() +                       #start with the default base map\n      tm_shape(monsters, bbox = aoi) +     #move the bounding box parameter here\n      tm_dots(size=.5) +\n    \n      tm_compass(position=c(\"left\", \"bottom\")) +     \n      tm_scalebar(position=c(\"left\", \"bottom\"))      \n    \n  \n  map_monsters                      \n```\n\n::: {.cell-output-display}\n![](tmap_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n\nWhat about a base layer with some more color or labels? Let's add the OpenStreetMap tile service.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n  #create a bounding box object for the zoom area of our map\n  aoi <- st_bbox(c(xmin = -96, xmax = -73, ymax = 50, ymin = 40), crs = st_crs(4326))\n\n\n\t  map_monsters <-  \n\t    tm_basemap(\"OpenStreetMap\") +                       #start with the default base map\n      tm_shape(monsters, bbox = aoi) +     \n      tm_dots(size=.5) +\n    \n      tm_compass(position=c(\"left\", \"bottom\")) +     \n      tm_scalebar(position=c(\"left\", \"bottom\"))      \n    \n  \n  map_monsters                      \n```\n\n::: {.cell-output-display}\n![](tmap_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n\n## Summary\n\nWe've seen that we can build a map in layers using `tmap` in a similar manner to the workflow we used in the base `plot()` workflow.  `tmap` has more built-in features for composing maps and finer control over some aspects of maps like north arrows and scale bars. It also has built-in base map tools which makes making a map quick.  But `tmap` still doesn't have an easy way to deal with label placement.",
    "supporting": [
      "tmap_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}